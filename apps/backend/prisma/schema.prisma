generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "mysql"
  url      = env("DATABASE_URL")
  shadowDatabaseUrl = env("SHADOW_DATABASE_URL")
}

model User {
  id         String       @id @default(uuid()) @db.Char(36)
  name       String
  email      String       @unique
  createdAt  DateTime     @default(now()) @map("created_at")
  updatedAt  DateTime     @updatedAt @map("updated_at")
  deletedAt  DateTime?    @map("deleted_at")

  // relation
  secret     UserSecret?
  matches    Match[]

  @@map("user")
}

model UserSecret {
  userId     String   @id @map("user_id")
  password   String

  // relation
  user       User     @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@map("user_secret")
}

model Stage {
  id      Int       @id @default(autoincrement())
  name    String    @unique

  matches Match[]

  @@map("stage")
}

model Rule {
  id      Int       @id @default(autoincrement())
  name    String    @unique

  matches Match[]

  @@map("rule")
}

model SubWeapon {
  id      Int       @id @default(autoincrement())
  name    String    @unique

  mainWeapons Weapon[]

  @@map("sub_weapon")
}

model SpecialWeapon {
  id      Int       @id @default(autoincrement())
  name    String    @unique

  mainWeapons Weapon[]

  @@map("special_weapon")
}

model Weapon {
  id              Int            @id @default(autoincrement())
  name            String         @unique
  subWeaponId     Int            @map("sub_weapon_id")
  specialWeaponId Int            @map("special_weapon_id")

  subWeapon       SubWeapon      @relation(fields: [subWeaponId], references: [id])
  specialWeapon   SpecialWeapon  @relation(fields: [specialWeaponId], references: [id])
  matches         Match[]

  @@map("weapon")
}

model BattleType {
  id      Int       @id @default(autoincrement())
  name    String    @unique

  matches Match[]

  @@map("battle_type")
}

model Match {
  id            String    @id @default(uuid()) @db.Char(36)
  result        String
  battleTypeId  Int       @map("battle_type_id")
  stageId       Int       @map("stage_id")
  ruleId        Int       @map("rule_id")
  weaponId      Int       @map("weapon_id")
  gameDateTime  DateTime  @map("game_date_time")
  point         Int?
  userId        String    @map("user_id") @db.Char(36)

  // relations
  battleType    BattleType @relation(fields: [battleTypeId], references: [id])
  stage         Stage     @relation(fields: [stageId], references: [id])
  rule          Rule      @relation(fields: [ruleId], references: [id])
  weapon        Weapon    @relation(fields: [weaponId], references: [id])
  user          User      @relation(fields: [userId], references: [id])

  @@map("match")
}
